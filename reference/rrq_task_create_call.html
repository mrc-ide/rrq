<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a task from a call — rrq_task_create_call • rrq</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a task from a call — rrq_task_create_call"><meta name="description" content="Create a task based on a function call.  This is fairly similar to
callr::r, and forms the basis of lapply()-like task
submission.  Sending a call may have slightly different semantics
than you expect if you send a closure (a function that binds
data), and we may change behaviour here until we find a happy set
of compromises.  See Details for more on this.  The expression
rrq_task_create_call(f, list(a, b, c)) is similar to
rrq_task_create_expr(f(a, b, c)), use whichever you prefer."><meta property="og:description" content="Create a task based on a function call.  This is fairly similar to
callr::r, and forms the basis of lapply()-like task
submission.  Sending a call may have slightly different semantics
than you expect if you send a closure (a function that binds
data), and we may change behaviour here until we find a happy set
of compromises.  See Details for more on this.  The expression
rrq_task_create_call(f, list(a, b, c)) is similar to
rrq_task_create_expr(f(a, b, c)), use whichever you prefer."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rrq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.23</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rrq.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/fault-tolerance.html">Fault tolerance</a></li>
    <li><a class="dropdown-item" href="../articles/messages.html">messages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/rrq/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a task from a call</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/rrq/blob/master/R/rrq_create.R" class="external-link"><code>R/rrq_create.R</code></a></small>
      <div class="d-none name"><code>rrq_task_create_call.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a task based on a function call.  This is fairly similar to
<a href="https://callr.r-lib.org/reference/r.html" class="external-link">callr::r</a>, and forms the basis of <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>-like task
submission.  Sending a call may have slightly different semantics
than you expect if you send a closure (a function that binds
data), and we may change behaviour here until we find a happy set
of compromises.  See Details for more on this.  The expression
<code>rrq_task_create_call(f, list(a, b, c))</code> is similar to
<code>rrq_task_create_expr(f(a, b, c))</code>, use whichever you prefer.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rrq_task_create_call</span><span class="op">(</span></span>
<span>  <span class="va">fn</span>,</span>
<span>  <span class="va">args</span>,</span>
<span>  queue <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  separate_process <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  timeout_task_run <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  depends_on <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  controller <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fn">fn<a class="anchor" aria-label="anchor" href="#arg-fn"></a></dt>
<dd><p>The function to call</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>A list of arguments to pass to the function</p></dd>


<dt id="arg-queue">queue<a class="anchor" aria-label="anchor" href="#arg-queue"></a></dt>
<dd><p>The queue to add the task to; if not specified the
"default" queue (which all workers listen to) will be used. If
you have configured workers to listen to more than one queue you
can specify that here. Be warned that if you push jobs onto a
queue with no worker, it will queue forever.</p></dd>


<dt id="arg-separate-process">separate_process<a class="anchor" aria-label="anchor" href="#arg-separate-process"></a></dt>
<dd><p>Logical, indicating if the task should be
run in a separate process on the worker. If <code>TRUE</code>, then the
worker runs the task in a separate process using the <code>callr</code>
package. This means that the worker environment is completely
clean, subsequent runs are not affected by preceding ones.  The
downside of this approach is a considerable overhead in starting
the external process and transferring data back.</p></dd>


<dt id="arg-timeout-task-run">timeout_task_run<a class="anchor" aria-label="anchor" href="#arg-timeout-task-run"></a></dt>
<dd><p>Optionally, a maximum allowed running
time, in seconds. This parameter only has an effect if
<code>separate_process</code> is <code>TRUE</code>. If given, then if the task takes
longer than this time it will be stopped and the task status set
to <code>TIMEOUT</code>.</p></dd>


<dt id="arg-depends-on">depends_on<a class="anchor" aria-label="anchor" href="#arg-depends-on"></a></dt>
<dd><p>Vector or list of IDs of tasks which must have
completed before this job can be run. Once all dependent tasks
have been successfully run, this task will get added to the
queue. If the dependent task fails then this task will be
removed from the queue.</p></dd>


<dt id="arg-controller">controller<a class="anchor" aria-label="anchor" href="#arg-controller"></a></dt>
<dd><p>The controller to use.  If not given (or <code>NULL</code>)
we'll use the controller registered with
<code><a href="rrq_default_controller_set.html">rrq_default_controller_set()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A task identifier (a 32 character hex string) that you can
pass in to other rrq functions, notably <code><a href="rrq_task_status.html">rrq_task_status()</a></code> and
<code><a href="rrq_task_result.html">rrq_task_result()</a></code></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Things are pretty unambiguous when you pass in a function from a
package, especially when you refer to that package with its
namespace (e.g. <code>pkg::fn</code>).</p>
<p>If you pass in the name <em>without a namespace</em> from a package that
you have loaded with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> locally but you have not loaded
with <code>library</code> within your worker environment, we may not do the
right thing and you may see your task fail, or find a different
function with the same name.</p>
<p>If you pass in an anonymous function (e.g., <code>function(x) x + 1</code>)
we may or may not do the right thing with respect to environment
capture.  We never capture the global environment so if your
function is a closure that tries to bind a symbol from the global
environment it will not work.  Like with <code><a href="https://callr.r-lib.org/reference/r.html" class="external-link">callr::r</a></code>, anonymous
functions will be easiest to think about where they are fully self
contained (i.e., all inputs to the functions come through <code>args</code>).
If you have bound a <em>local</em> environment, we may do slightly
better, but semantics here are undefined and subject to change.</p>
<p>R does some fancy things with function calls that we don't try to
replicate.  In particular you may have noticed that this works:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="st">"x"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">c</span>(c, c) <span class="co"># a vector of two "x"'s</span></span></code></pre><p></p></div>
<p>You can end up in this situation locally with:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="fu">f</span>(f) <span class="co"># 2</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>})</span></code></pre><p></p></div>
<p>this is because when R looks for the symbol for the call it skips
over non-function objects.  We don't reconstruct environment
chains in exactly the same way as you would have locally so this
is not possible.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># rrq:::enable_examples(require_queue = "rrq:example")</span></span></span>
<span class="r-in"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="rrq_controller.html">rrq_controller</a></span><span class="op">(</span><span class="st">"rrq:example"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">rrq_task_create_call</span><span class="op">(</span><span class="va">sqrt</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, controller <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="rrq_task_wait.html">rrq_task_wait</a></span><span class="op">(</span><span class="va">t</span>, controller <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="rrq_task_result.html">rrq_task_result</a></span><span class="op">(</span><span class="va">t</span>, controller <span class="op">=</span> <span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Robert Ashton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

