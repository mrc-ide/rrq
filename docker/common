## -*-sh-*-
PACKAGE_ROOT=$(realpath $HERE/..)
PACKAGE_NAME=rrq
PACKAGE_ORG=mrcide

WORKER_NAME=rrq-worker

GIT_SHA=$(git -C "$PACKAGE_ROOT" rev-parse --short=7 HEAD)
PKG_VERSION=$(cat $PACKAGE_ROOT/DESCRIPTION | grep '^Version:' | sed 's/^.*: *//')

if [ "$TRAVIS" = "true" ]; then
    GIT_BRANCH=$TRAVIS_BRANCH
else
    GIT_BRANCH=$(git -C "$PACKAGE_ROOT" symbolic-ref --short HEAD)
fi

TAG_SHA="${PACKAGE_ORG}/${PACKAGE_NAME}:${GIT_SHA}"
TAG_BRANCH="${PACKAGE_ORG}/${PACKAGE_NAME}:${GIT_BRANCH}"
TAG_VERSION="${PACKAGE_ORG}/${PACKAGE_NAME}:v${PKG_VERSION}"
TAG_LATEST="${PACKAGE_ORG}/${PACKAGE_NAME}:latest"

TAG_WORKER_SHA="${PACKAGE_ORG}/${WORKER_NAME}:${GIT_SHA}"
TAG_WORKER_BRANCH="${PACKAGE_ORG}/${WORKER_NAME}:${GIT_BRANCH}"
TAG_WORKER_VERSION="${PACKAGE_ORG}/${WORKER_NAME}:v${PKG_VERSION}"
TAG_WORKER_LATEST="${PACKAGE_ORG}/${WORKER_NAME}:latest"
